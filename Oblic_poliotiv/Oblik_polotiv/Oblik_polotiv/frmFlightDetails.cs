using System;
using System.Collections.Generic;
using System.IO;
using System.Windows.Forms;
using ZXing;
using ZXing.QrCode;

namespace Oblik_polotiv
{
    public partial class frmFlightDetails : UserControl
    {
        public Flight flight { get; set; }
        public frmFlightDetails()
        {
            InitializeComponent();
            
        }
        public void EnterData()
        {
            if (flight != null)
            {
                flightRoute.Text = flight.direction.from_City + "( " + flight.direction.from_Country + " ) - "
                     + flight.direction.to_City + "( " + flight.direction.to_Country + " ) ";
                lblCarrier.Text = flight.carrier;
                lblRoute.Text = flight.direction.from_Airport + " " + flight.direction.from_City + "( " + flight.direction.from_Country +
                    " ) → " + flight.direction.to_Airport + flight.direction.to_City + "( " + flight.direction.to_Country + " ) ";
                if (flight.cls.Equals("First"))
                    lblPrice.Text = "Price: " + (flight.from_Price * 2) + "$";
                else if (flight.cls.Equals("Business"))
                    lblPrice.Text = "Price: " + (flight.from_Price * 1.5) + "$";
                else
                    lblPrice.Text = "Price: " + flight.from_Price + "$";
                lblDepart.Text = flight.depart.Hour + ":" + flight.depart.Minute;
                lblArrive.Text = flight.arrive.Hour + ":" + flight.arrive.Minute;
                lblFliTime.Text = (flight.arrive.Hour - flight.depart.Hour) + "h " + (flight.arrive.Minute - flight.depart.Minute);
                lstBoxPilots.Items.AddRange(flight.pilots.ToArray());
                var writer = new BarcodeWriter();
                writer.Format = BarcodeFormat.QR_CODE; 
                var text = flight.ToString();
                text += "\n" + lblPrice.Text;
                var result = writer.Write(text);
                picBoxQR.Image = result;
                lblID.Text = "№" + flight.id;
            }
        }

        private void btnSaveFlight_Click(object sender, EventArgs e)
        {
            if(saveFileDialog.ShowDialog() == DialogResult.OK)
            {
                string name = saveFileDialog.FileName;
                string text = flight.ToString();
                text += "\n" + lblPrice.Text + "\n\n This file is generated by FlightNow";
                File.WriteAllText(name, text);
            }
        }       

        private void btnReturnFlight_Click(object sender, EventArgs e)
        {
            Form1 frmReturn = new Form1();
            frmReturn.FromBox.Text = flight.direction.GetBackDirection().from_City;
            frmReturn.ToBox.Text = flight.direction.GetBackDirection().to_City;
            frmReturn.DepartBox.Text = flight.arrive.ToString();
            frmReturn.SearchFilter.SelectedIndex = 1;
            frmReturn.frmSearchResults.frmFlightDetails.btnReturnFlight.Hide();
            frmReturn.ShowDialog();
        }
    }
}
